<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Directions Service</title>

    <!-- <script src="https://unpkg.com/@turf/turf@3.5.2/turf.min.js"></script> -->

    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@5/turf.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />  
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>  
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<!-- Google Maps JavaScript library -->
<!-- <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=AIzaSyBoczywhygb-PhG_U1-bRj7UlbjZfv6iyg"></script> -->
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #floating-panel {
        position: absolute;
        top: 1%;
        left: 10%;
        right:10%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }


      #title{
        position: absolute;
        top: 1%;
        left: 30%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }

      ::-webkit-search-cancel-button {
    height: 10px;
    width: 10px;
    display: inline-block;
    background: blue;
}
    </style>
  </head>
  <body>

<!-- <div id='title'>

</div> -->
<!-- <img style="cursor: pointer;height: 90px;width: 100px;" onclick="route()" src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/747/maps-icon.png" /> -->
    <div id="floating-panel">
      <b><h4>Smart Handy Adjustable Map-Reading Navigation Application (SHAMPA)</h4> Find smart route to avoid containment zone</b>
<!-- <p>A navigation tool to avoid contentment zone and get the best route (Only for Kolkata and Howrah)</p> -->
    <!-- <b>Start: </b> -->

    <input type="search" class="form-control" id="start"  placeholder="Type start address..." />
    <!-- <select id="start">
      <option value="jadavpur,kolkata">Jadavpur</option>
      <option value="howrah station,kolkata">Howrah Station</option>
      <option value="victoria memorial , kolkata">Victoria Memorial</option>
      <option value="indian museum,kolkata">Indian Museum</option>
      <option value="eco park,kolkata">Eco Park</option>
      <option value="gallup, nm">Gallup, NM</option>
      <option value="flagstaff, az">Flagstaff, AZ</option>
      <option value="winona, az">Winona</option>
      <option value="kingman, az">Kingman</option>
      <option value="barstow, ca">Barstow</option>
      <option value="san bernardino, ca">San Bernardino</option>
      <option value="los angeles, ca">Los Angeles</option>
    </select> -->
    <!-- <b>End: </b> -->

    <input type="search" class="form-control" id="end" placeholder="Type end address..." />

    <!-- <button onclick="route()">Navigation</button> -->
<!-- <p>If you want detailed navigation thorugh the route click "Navigation"</p>
    <button onclick="route()">Navigation</button>
    <br>
    <img src="22.png" style="width: 100px;"> Safe Route <br>

    <img src="11.png" style="width: 100px;"> Unsafe Route -->
    
    <!-- <select id="end">
      <option value="jadavpur,kolkata">Jadavpur</option>
      <option value="howrah station,kolkata">Howrah Station</option>
      <option value="victoria memorial , kolkata">Victoria Memorial</option>
      <option value="indian museum,kolkata">Indian Museum</option>
      <option value="eco park,kolkata">Eco Park</option>
    </select> -->
    </div>
    <div id="map"></div>
    <script>

function route()
{

var start= document.getElementById('start').value;
var end = document.getElementById('end').value;

var url = 'https://www.google.com/maps/dir/?api=1&travelmode=walking&layer=traffic&origin='+start+'&destination='+end


// window.location.href=
window.open(url, "_blank");

}






      function initMap() {



        $(document).ready(function () {
 var autocomplete;
 var autocomplete1;
 autocomplete = new google.maps.places.Autocomplete((document.getElementById('start')), {
  types: ['geocode'],
//   componentRestrictions: {
//    country: "India"
//   }
 });


 autocomplete1 = new google.maps.places.Autocomplete((document.getElementById('end')), {
  types: ['geocode'],
//   componentRestrictions: {
//    country: "India"
//   }
 });
  
 google.maps.event.addListener(autocomplete, 'place_changed', function () {
  var near_place = autocomplete.getPlace();
 });


 google.maps.event.addListener(autocomplete1, 'place_changed', function () {
  var near_place = autocomplete1.getPlace();
 });
});


arr10=[]




        var directionsService = new google.maps.DirectionsService;
        
        directionsDisplay = new google.maps.DirectionsRenderer;
        directionsDisplay1 = new google.maps.DirectionsRenderer;
        directionsDisplay2 = new google.maps.DirectionsRenderer;
        directionsDisplay3 = new google.maps.DirectionsRenderer;




        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 12,
          center: {lat: 22.542888, lng: 88.342429}
        });
        directionsDisplay.setMap(map);
        directionsDisplay1.setMap(map);
        directionsDisplay2.setMap(map);
        directionsDisplay3.setMap(map);


        var geocoder = new google.maps.Geocoder;



        if (navigator.geolocation) {
   navigator.geolocation.getCurrentPosition(function(position) {
     var pos = {
       lat: position.coords.latitude,
       lng: position.coords.longitude
     };
     console.log(position);
    //  infoWindow.setPosition(pos);
    //  infoWindow.setContent('<b>You are here.</b>');
     map.setCenter(pos);
     


     geocoder.geocode({'location': pos}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              map.setZoom(15);
              // var marker = new google.maps.Marker({
              //   position: latlng,
              //   map: map
              // });
              // infowindow.setContent(results[0].formatted_address);
              // infowindow.open(map, marker);

              console.log(results[0])
              document.getElementById('start').value = results[0].formatted_address;
            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });





     var marker = new google.maps.Marker({
       position: pos,
       map: map,
       title: String(pos.lat) + ", " + String(pos.lng),
     });
   }, function() {
     handleLocationError(true, infoWindow, map.getCenter());
   });
 } else {
   // Browser doesn't support Geolocation
   handleLocationError(false, infoWindow, map.getCenter());
 }










        var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {

      var res = this.responseText;
    var obj = JSON.parse(res);


for (var m=0;m<obj.user.length;m++)
{

  arr10.push(turf.point([obj.user[m].Longitude,obj.user[m].Latitude]))

var arr2=[]

//         var pt = {
//   // "type": "Feature",
//   // "properties": {},
//   "geometry": {
//     "type": "Point",
//     "coordinates": [88.363920,22.514054]
//   }
// };
// var unit = 'meters';
var point = turf.point([obj.user[m].Longitude,obj.user[m].Latitude]);

var buffered = turf.buffer(point, 70, {units: 'meters'});

//console.log(buffered.geometry.coordinates[0][1][1])

for (var b=0;b<buffered.geometry.coordinates[0].length;b++)
{

      arr2.push({lat:parseFloat(buffered.geometry.coordinates[0][b][1]),lng:parseFloat(buffered.geometry.coordinates[0][b][0])})
}

//console.log(arr2)
// var point = turf.point([2, 2]);
// var line = turf.lineString([[1, 1], [1, 2], [1, 3], [1, 4]]);

// console.log(turf.booleanDisjoint(line, point));






        // map.data.add({geometry:new google.maps.Data.Point({lat:22.514054, lng: 88.363920})});

        map.data.add({geometry:new google.maps.Data.Polygon([arr2])})
}







    }
  };



  var url = "https://script.googleusercontent.com/macros/echo?user_content_key=3MMa5Ho3lhwEtJjnia4x0YeVlmsyilEYG3x-2_77gu9fHtSTk6wq-TrcHt4KFMQ_Of6tOp50LQS7wrp48_qabO7FcZiQkX05m5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnL2ALDHBeNGHsErmYNP9H5CBVJ5X2UIJZi9yBvlSqqCQb4HMD2GV77H3GikvkQxhp56kQcL6KD07&lib=MD63v8JkHoX1GlycZdQurRaL6kPo5RDVa"
 //var url = "https://yacdn.org/serve/https://data.thejeshgn.com/covid19/_design/india/_view/incidents?descending=false&nounce="+yyyy+mm+0+dd 
  
  xhttp.open("GET", url , true);
  xhttp.send();





        var onChangeHandler = function() {
          calculateAndDisplayRoute(directionsService, directionsDisplay,directionsDisplay1,directionsDisplay2,directionsDisplay3);
        };
        document.getElementById('start').addEventListener('change', onChangeHandler);
        document.getElementById('end').addEventListener('change', onChangeHandler);
      }

      function calculateAndDisplayRoute(directionsService, directionsDisplay , directionsDisplay1) {
        directionsService.route({
          origin: document.getElementById('start').value,
          destination: document.getElementById('end').value,
          travelMode: 'WALKING',
          provideRouteAlternatives: true
        }, function(response, status) {
          if (status === 'OK') {

            // for (var i = 0, len = response.routes.length; i < len; i++) {
            //   directionsDisplay.setDirections({
                    
            //         directions: response,
            //         routeIndex: i
            //     });
            // }


              // for (var i = 0, len = response.routes.length; i < len; i++) {



             //imp   
            directionsDisplay.setDirections(response);

            directionsDisplay.setOptions({
  polylineOptions: {
    strokeColor: 'red'
  }
});
            directionsDisplay.setRouteIndex(0);    

            // var ind = directionsDisplay.getRouteIndex();    

            directionsDisplay1.setDirections(response);



            directionsDisplay1.setOptions({
  polylineOptions: {
    strokeColor: 'red'
  }
});



            directionsDisplay1.setRouteIndex(1);  

            if (response.routes.length>2)
            {
              directionsDisplay3.setDirections(response);



            directionsDisplay3.setOptions({
  polylineOptions: {
    strokeColor: 'red'
  }
});



            directionsDisplay3.setRouteIndex(2);

            }




            
    

            // var ind1 = directionsDisplay1.getRouteIndex();  
            
            



            // directionsDisplay1.setRouteIndex(0);    
            // directionsDisplay1.setDirections(response);
            


            // new google.maps.DirectionsRenderer({

            //         map: map,
            //         directions: directionsDisplay.setDirections(response),
            //         routeIndex: i
            //     });



              // }

              // var arr2=[]
              //console.log(arr10)

              var fc = turf.featureCollection(arr10);

var combined = turf.combine(fc);

//console.log(combined)

              //var unit = 'meters';

              var point = turf.point([88.363920,22.514054]);

var buffered = turf.buffer(combined, 70, {units: 'meters'});

// console.log(buffered.geometry.coordinates[0][1][1])

// for (var b=0;b<buffered.geometry.coordinates[0].length;b++)
// {

//       arr2.push({lat:parseFloat(buffered.geometry.coordinates[0][b][1]),lng:parseFloat(buffered.geometry.coordinates[0][b][0])})
// }

// console.log(arr2)


arr20=[]

for (var i = 0, len = response.routes.length; i < len; i++) {

              var path = response.routes[i].overview_path

              arr=[]
              arr1=[]

              // arr3=[]


              for (var j=0;j<path.length;j++)
{

            arr.push((path[j].toUrlValue(6).split(",")))
}



              //console.log(arr)


              for (var a=0;a<arr.length;a++)
{
   arr1.push([parseFloat(arr[a][1]),parseFloat(arr[a][0])]) 
}


// for (var k=0;k<arr1.length;k++)
// {

//   arr3.push({lat:arr1[k][0],lng:arr1[k][1]})

// }






var line = turf.lineString(arr1)


if(turf.booleanDisjoint(line, buffered))
{
  directionsDisplay2.setDirections(response);
  directionsDisplay2.setRouteIndex(i);


  directionsDisplay2.setOptions({
  polylineOptions: {
    strokeColor: 'green'
  }
});
  var ind1 = directionsDisplay2.getRouteIndex();  
  console.log("Route selected: "+ind1)
  arr20.push(ind1)

}


// else{
//   alert ("No suitable route found")
// }

}
console.log("Total Route Returned: "+response.routes.length)
// console.log(arr3)

console.log(arr20)







              // console.log(ind+" "+ind1)
              
          } else {
            window.alert('Directions request failed due to ' + status);
          }
        });
      }
    </script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&key=AIzaSyBswGDKuPpg38AiI1ubQapxF2pBR9zVK6Q&callback=initMap">
</script>
    
  </body>
</html>